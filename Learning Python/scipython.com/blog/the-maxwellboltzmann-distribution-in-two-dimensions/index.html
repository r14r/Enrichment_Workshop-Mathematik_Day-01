<!doctype html>
<html lang="en">


<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="keywords" content="">
<meta name="description" content="This script demonstrates the relaxation of an ensemble of colliding particles towards the equilibrium, Maxwell-Boltzmann distribution of their speeds. Unlike this previous post, the collision detection and dynamics are handled using NumPy arrays without explicit python loops (except over collision pairs), which improves the performance greatly.">
<title>The Maxwellâ€“Boltzmann distribution in two dimensions</title>
<link rel="shortcut icon" href="/static/img/favicon.ico">


<link rel="alternate" type="application/rss+xml" title="RSS" href="/blog/feeds/rss/">
<link rel="alternate" type="application/atom+xml" title="Atom" href="/blog/feeds/atom/">



<link rel="stylesheet" href="/static/css/bootstrap.css">
<link rel="stylesheet" href="/static/css/mezzanine.css">
<link rel="stylesheet" href="/static/css/codehilite.css">
<link rel="stylesheet" href="/static/css/custom.css">






<script src="/static/mezzanine/js/jquery-1.8.3.min.js"></script>
<script src="/static/js/bootstrap.js"></script>
<script src="/static/js/bootstrap-extras.js"></script>



<!--[if lt IE 9]>
<script src="/static/js/html5shiv.js"></script>
<script src="/static/js/respond.min.js"></script>
<![endif]-->



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


</head>

<body id="body">

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
<div class="container">
<div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle Navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
    
    
</div>
<div class="navbar-collapse collapse">
    
<form action="/search/" class="navbar-form navbar-right" role="search">

<div class="form-group">
    <input class="form-control" placeholder="Search" type="text" name="q" value="">
</div>


    
    <div class="form-group">
    <select class="form-control" name="type">
        <option value="">Everything</option>
        
        <option value="blog.BlogPost"
            >
            Blog posts
        </option>
        
        <option value="pages.Page"
            >
            Pages
        </option>
        
    </select>
    </div>
    


<input type="submit" class="btn btn-default" value="Go">

</form>

    
<ul class="nav navbar-nav"><li id="dropdown-menu-home"><a href="/">Home</a></li><li class="dropdown
               "
        id="about"><a href="/about/"
        
        class="dropdown-toggle disabled" data-toggle="dropdown"
        >
            About
            <b class="caret"></b></a><ul class="dropdown-menu"><li class="
               "
        id="about-the-author"><a href="/about/the-author/">The Author</a></li><li class="
               "
        id="about-the-book"><a href="/about/the-book/">The Book</a></li><li class="
               "
        id="about-this-website"><a href="/about/this-website/">This Website</a></li></ul></li><li class="dropdown
               "
        id="book"><a href="/book/"
        
        class="dropdown-toggle disabled" data-toggle="dropdown"
        >
            Book
            <b class="caret"></b></a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-1-introduction"><a href="/book/chapter-1-introduction/">Chapter 1: Introduction</a></li><li class="dropdown-submenu
               "
        id="book-chapter-2-the-core-python-language-i"><a href="/book/chapter-2-the-core-python-language-i/">Chapter 2: The Core Python Language I</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-2-the-core-python-language-i-examples"><a href="/book/chapter-2-the-core-python-language-i/examples/">Examples</a></li><li class="
               "
        id="book-chapter-2-the-core-python-language-i-questions"><a href="/book/chapter-2-the-core-python-language-i/questions/">Questions</a></li><li class="
               "
        id="book-chapter-2-the-core-python-language-i-questions-problems"><a href="/book/chapter-2-the-core-python-language-i/questions/problems/">Problems</a></li><li class="
               "
        id="book-chapter-2-the-core-python-language-i-additional-problems"><a href="/book/chapter-2-the-core-python-language-i/additional-problems/">Additional Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-3-simple-plotting-with-pylab"><a href="/book/chapter-3-simple-plotting-with-pylab/">Chapter 3: Simple Plotting with pylab</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-3-simple-plotting-with-pylab-examples"><a href="/book/chapter-3-simple-plotting-with-pylab/examples/">Examples</a></li><li class="
               "
        id="book-chapter-3-simple-plotting-with-pylab-problems"><a href="/book/chapter-3-simple-plotting-with-pylab/problems/">Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-4-the-core-python-language-ii"><a href="/book/chapter-4-the-core-python-language-ii/">Chapter 4: The core Python language II</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-4-the-core-python-language-ii-examples"><a href="/book/chapter-4-the-core-python-language-ii/examples/">Examples</a></li><li class="
               "
        id="book-chapter-4-the-core-python-language-ii-questions"><a href="/book/chapter-4-the-core-python-language-ii/questions/">Questions</a></li><li class="
               "
        id="book-chapter-4-the-core-python-language-ii-problems"><a href="/book/chapter-4-the-core-python-language-ii/problems/">Problems</a></li><li class="
               "
        id="book-chapter-4-the-core-python-language-ii-additional-problems"><a href="/book/chapter-4-the-core-python-language-ii/additional-problems/">Additional Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-5-ipython-and-ipython-notebook"><a href="/book/chapter-5-ipython-and-ipython-notebook/">Chapter 5: IPython and IPython Notebook</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-5-ipython-and-ipython-notebook-examples"><a href="/book/chapter-5-ipython-and-ipython-notebook/examples/">Examples</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-6-numpy"><a href="/book/chapter-6-numpy/">Chapter 6: NumPy</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-6-numpy-examples"><a href="/book/chapter-6-numpy/examples/">Examples</a></li><li class="
               "
        id="book-chapter-6-numpy-questions"><a href="/book/chapter-6-numpy/questions/">Questions</a></li><li class="
               "
        id="book-chapter-6-numpy-problems"><a href="/book/chapter-6-numpy/problems/">Problems</a></li><li class="
               "
        id="book-chapter-6-numpy-additional-examples"><a href="/book/chapter-6-numpy/additional-examples/">Additional Examples</a></li><li class="
               "
        id="book-chapter-6-numpy-additional-problems"><a href="/book/chapter-6-numpy/additional-problems/">Additional Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-7-matplotlib"><a href="/book/chapter-7-matplotlib/">Chapter 7: Matplotlib</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-7-matplotlib-examples"><a href="/book/chapter-7-matplotlib/examples/">Examples</a></li><li class="
               "
        id="book-chapter-7-matplotlib-questions"><a href="/book/chapter-7-matplotlib/questions/">Questions</a></li><li class="
               "
        id="book-chapter-7-matplotlib-problems"><a href="/book/chapter-7-matplotlib/problems/">Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-8-scipy"><a href="/book/chapter-8-scipy/">Chapter 8: SciPy</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-8-scipy-examples"><a href="/book/chapter-8-scipy/examples/">Examples</a></li><li class="
               "
        id="book-chapter-8-scipy-questions"><a href="/book/chapter-8-scipy/questions/">Questions</a></li><li class="
               "
        id="book-chapter-8-scipy-problems"><a href="/book/chapter-8-scipy/problems/">Problems</a></li><li class="
               "
        id="book-chapter-8-scipy-additional-examples"><a href="/book/chapter-8-scipy/additional-examples/">Additional Examples</a></li><li class="
               "
        id="book-chapter-8-scipy-additional-problems"><a href="/book/chapter-8-scipy/additional-problems/">Additional Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-9-general-scientific-programming"><a href="/book/chapter-9-general-scientific-programming/">Chapter 9: General Scientific Programming</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-9-general-scientific-programming-examples"><a href="/book/chapter-9-general-scientific-programming/examples/">Examples</a></li><li class="
               "
        id="book-chapter-9-general-scientific-programming-questions"><a href="/book/chapter-9-general-scientific-programming/questions/">Questions</a></li><li class="
               "
        id="book-chapter-9-general-scientific-programming-problems"><a href="/book/chapter-9-general-scientific-programming/problems/">Problems</a></li></ul></li><li class="
               "
        id="book-errata"><a href="/book/errata/">Errata</a></li></ul></li><li class="
               active"
        id="blog"><a href="/blog/"
        >
            Blog
            
        </a></li><li class="
               "
        id="apps"><a href="/apps/"
        >
            Apps
            
        </a></li><li class="
               "
        id="contact"><a href="/contact/"
        >
            Contact
            
        </a></li></ul>

</div>
</div>
</div>

<div class="container">





<ul class="breadcrumb">
<li id="breadcrumb-menu-home"><a href="/">Home</a></li><li id="breadcrumb-menu-blog"><a href="/blog/">Blog</a></li><li class="active">The Maxwellâ€“Boltzmann distribution in two dimensions</li>
</ul>

<h1>
The Maxwellâ€“Boltzmann distribution in two dimensions
</h1>

</div>

<div class="container">
<div class="row">

<div class="col-md-12 middle" style="max-width: 760px;">
    



<h6 class="post-meta">
    Posted by:
    
    <a href="/blog/author/christian/">christian</a> on
    
    14 Jul 2020
</h6>



<p>
    
        (<a href="#comments">0 comments</a>)
        
    
</p>






<p>This script demonstrates the relaxation of an ensemble of colliding particles towards the equilibrium, Maxwell-Boltzmann distribution of their speeds. Unlike <a href="/blog/two-dimensional-collisions/">this previous post</a>, the collision detection and dynamics are handled using NumPy arrays without explicit python loops (except over collision pairs), which improves the performance greatly.</p>
<p>At the time of writing, Matplotlib does not provide an out-of-the-box way to animate histograms, so the code defines a <code>Histogram</code> class to facilitate this, based on <a href="https://matplotlib.org/3.1.1/gallery/animation/animated_histogram.html">this Matplotlib example</a>.</p>
<p>The particles are initialised with uniformly-random positions and a fixed speed (randomly-oriented in direction). After an initial relaxation period, their speed distribution is averaged incrementally and compared with the Maxwell-Boltzmann distribution function,
$$
f(v) = \frac{mv}{k_\mathrm{B}T}\exp\left(-\frac{mv^2}{2k_\mathrm{B}T}\right).
$$</p>
<div class="wrapper">
<iframe height="315" src="https://www.youtube.com/embed/GpTDkARVOuE" width="560"></iframe>
</div>

<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">pdist</span><span class="p">,</span> <span class="n">squareform</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="kn">as</span> <span class="nn">patches</span>
<span class="kn">import</span> <span class="nn">matplotlib.path</span> <span class="kn">as</span> <span class="nn">path</span>
<span class="kn">from</span> <span class="nn">matplotlib.animation</span> <span class="kn">import</span> <span class="n">FuncAnimation</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="k">class</span> <span class="nc">MDSimulation</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Initialize the simulation with identical, circular particles of radius</span>
<span class="sd">        r and mass m. The n x 2 state arrays pos and vel hold the n particles'</span>
<span class="sd">        positions in their rows as (x_i, y_i) and (vx_i, vy_i).</span>

<span class="sd">        """</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nsteps</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">advance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="sd">"""Advance the simulation by dt seconds."""</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nsteps</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Update the particles' positions according to their velocities.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="c1"># Find indices for all unique collisions.</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">squareform</span><span class="p">(</span><span class="n">pdist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
        <span class="n">iarr</span><span class="p">,</span> <span class="n">jarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">iarr</span> <span class="o">&lt;</span> <span class="n">jarr</span>
        <span class="n">iarr</span><span class="p">,</span> <span class="n">jarr</span> <span class="o">=</span> <span class="n">iarr</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">jarr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="c1"># For each collision, update the velocities of the particles involved.</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">iarr</span><span class="p">,</span> <span class="n">jarr</span><span class="p">):</span>
            <span class="n">pos_i</span><span class="p">,</span> <span class="n">vel_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">pos_j</span><span class="p">,</span> <span class="n">vel_j</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">rel_pos</span><span class="p">,</span> <span class="n">rel_vel</span> <span class="o">=</span> <span class="n">pos_i</span> <span class="o">-</span> <span class="n">pos_j</span><span class="p">,</span> <span class="n">vel_i</span> <span class="o">-</span> <span class="n">vel_j</span>
            <span class="n">r_rel</span> <span class="o">=</span> <span class="n">rel_pos</span> <span class="err">@</span> <span class="n">rel_pos</span>
            <span class="n">v_rel</span> <span class="o">=</span> <span class="n">rel_vel</span> <span class="err">@</span> <span class="n">rel_pos</span>
            <span class="n">v_rel</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rel_pos</span> <span class="o">*</span> <span class="n">v_rel</span> <span class="o">/</span> <span class="n">r_rel</span> <span class="o">-</span> <span class="n">rel_vel</span>
            <span class="n">v_cm</span> <span class="o">=</span> <span class="p">(</span><span class="n">vel_i</span> <span class="o">+</span> <span class="n">vel_j</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_cm</span> <span class="o">+</span> <span class="n">v_rel</span><span class="o">/</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_cm</span> <span class="o">-</span> <span class="n">v_rel</span><span class="o">/</span><span class="mi">2</span>

        <span class="c1"># Bounce the particles off the walls where necessary, by reflecting</span>
        <span class="c1"># their velocity vectors.</span>
        <span class="n">hit_left_wall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[:,</span> <span class="n">X</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span>
        <span class="n">hit_right_wall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[:,</span> <span class="n">X</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span>
        <span class="n">hit_bottom_wall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[:,</span> <span class="n">Y</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span>
        <span class="n">hit_top_wall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[:,</span> <span class="n">Y</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="n">hit_left_wall</span> <span class="o">|</span> <span class="n">hit_right_wall</span><span class="p">,</span> <span class="n">X</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="n">hit_bottom_wall</span> <span class="o">|</span> <span class="n">hit_top_wall</span><span class="p">,</span> <span class="n">Y</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

<span class="c1"># Number of particles.</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="c1">#Â Scaling factor for distance, m-1. The box dimension is therefore 1/rscale.</span>
<span class="n">rscale</span> <span class="o">=</span> <span class="mf">5.e6</span>
<span class="c1"># Use the van der Waals radius of Ar, about 0.2 nm.</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">2e-10</span> <span class="o">*</span> <span class="n">rscale</span>
<span class="c1"># Scale time by this factor, in s-1.</span>
<span class="n">tscale</span> <span class="o">=</span> <span class="mf">1e9</span>    <span class="c1"># i.e. time will be measured in nanoseconds.</span>
<span class="c1"># Take the mean speed to be the root-mean-square velocity of Ar at 300 K.</span>
<span class="n">sbar</span> <span class="o">=</span> <span class="mi">353</span> <span class="o">*</span> <span class="n">rscale</span> <span class="o">/</span> <span class="n">tscale</span>
<span class="c1"># Time step in scaled time units.</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">FPS</span>
<span class="c1"># Particle masses, scaled by some factor we're not using yet.</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Initialize the particles' positions randomly.</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1"># Initialize the particles velocities with random orientations and random</span>
<span class="c1"># magnitudes  around the mean speed, sbar.</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">s0</span> <span class="o">=</span> <span class="n">sbar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">vel</span> <span class="o">=</span> <span class="p">(</span><span class="n">s0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))))</span><span class="o">.</span><span class="n">T</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">MDSimulation</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

<span class="c1"># Set up the Figure and make some adjustments to improve its appearance.</span>
<span class="n">DPI</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="n">DPI</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="n">DPI</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.97</span><span class="p">)</span>
<span class="n">sim_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">'equal'</span><span class="p">,</span> <span class="n">autoscale_on</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">sim_ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">sim_ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="c1"># Make the box walls a bit more substantial.</span>
<span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">sim_ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">spine</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">speed_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">speed_ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Speed $v\,/m\,s^{-1}$'</span><span class="p">)</span>
<span class="n">speed_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'$f(v)$'</span><span class="p">)</span>

<span class="n">particles</span><span class="p">,</span> <span class="o">=</span> <span class="n">sim_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s1">'ko'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Histogram</span><span class="p">:</span>
    <span class="sd">"""A class to draw a Matplotlib histogram as a collection of Patches."""</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">nbars</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">"""Initialize the histogram from the data and requested bins."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbars</span> <span class="o">=</span> <span class="n">nbars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density</span> <span class="o">=</span> <span class="n">density</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">nbars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>

        <span class="c1"># Drawing the histogram with Matplotlib patches owes a lot to</span>
        <span class="c1"># https://matplotlib.org/3.1.1/gallery/animation/animated_histogram.html</span>
        <span class="c1"># Get the corners of the rectangles for the histogram.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hist</span>
        <span class="n">nrects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nverts</span> <span class="o">=</span> <span class="n">nrects</span> <span class="o">*</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nverts</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">"""Draw the histogram by adding appropriate patches to Axes ax."""</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nverts</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span>
        <span class="n">codes</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span>
        <span class="n">codes</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span>
        <span class="n">barpath</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">barpath</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">'tab:green'</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span>
                                  <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">"""Update the rectangle vertices using a new histogram from data."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hist</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>


<span class="k">def</span> <span class="nf">get_speeds</span><span class="p">(</span><span class="n">vel</span><span class="p">):</span>
    <span class="sd">"""Return the magnitude of the (n,2) array of velocities, vel."""</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">vel</span><span class="p">[:,</span> <span class="n">X</span><span class="p">],</span> <span class="n">vel</span><span class="p">[:,</span> <span class="n">Y</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">get_KE</span><span class="p">(</span><span class="n">speeds</span><span class="p">):</span>
    <span class="sd">"""Return the total kinetic energy of all particles in scaled units."""</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sim</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">speeds</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">speeds</span> <span class="o">=</span> <span class="n">get_speeds</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">vel</span><span class="p">)</span>
<span class="n">speed_hist</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="n">speeds</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sbar</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">speed_hist</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">speed_ax</span><span class="p">)</span>
<span class="n">speed_ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">speed_hist</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">speed_hist</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># TODO don't hardcode the upper limit for the histogram speed axis.</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">speed_ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span> <span class="o">*</span> <span class="n">rscale</span><span class="o">/</span><span class="n">tscale</span><span class="p">)</span>
<span class="n">speed_ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">tick</span><span class="p">)</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">])</span>
<span class="n">speed_ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># The 2D Maxwell-Boltzmann equilibrium distribution of speeds.</span>
<span class="n">mean_KE</span> <span class="o">=</span> <span class="n">get_KE</span><span class="p">(</span><span class="n">speeds</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">m</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">mean_KE</span>
<span class="c1"># Use a high-resolution grid of speed points so that the exact distribution</span>
<span class="c1"># looks smooth.</span>
<span class="n">sgrid_hi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">speed_hist</span><span class="o">.</span><span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">sgrid_hi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span> <span class="o">*</span> <span class="n">sgrid_hi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mb_line</span><span class="p">,</span> <span class="o">=</span> <span class="n">speed_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sgrid_hi</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">'0.7'</span><span class="p">)</span>
<span class="c1"># Maximum value of the 2D Maxwell-Boltzmann speed distribution.</span>
<span class="n">fmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">m</span> <span class="o">/</span> <span class="n">mean_KE</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
<span class="n">speed_ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fmax</span><span class="p">)</span>

<span class="c1"># For the distribution derived by averaging, take the abcissa speed points from</span>
<span class="c1"># the centre of the histogram bars.</span>
<span class="n">sgrid</span> <span class="o">=</span> <span class="p">(</span><span class="n">speed_hist</span><span class="o">.</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">speed_hist</span><span class="o">.</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">mb_est_line</span><span class="p">,</span> <span class="o">=</span> <span class="n">speed_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">c</span><span class="o">=</span><span class="s1">'r'</span><span class="p">)</span>
<span class="n">mb_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sgrid</span><span class="p">))</span>

<span class="c1"># A text label indicating the time and step number for each animation frame.</span>
<span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="n">sgrid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">fmax</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">speed_ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="s1">'$t$ = {:.1f}s, step = {:d}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">init_anim</span><span class="p">():</span>
    <span class="sd">"""Initialize the animation"""</span>
    <span class="n">particles</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>

    <span class="k">return</span> <span class="n">particles</span><span class="p">,</span> <span class="n">speed_hist</span><span class="o">.</span><span class="n">patch</span><span class="p">,</span> <span class="n">mb_est_line</span><span class="p">,</span> <span class="n">label</span>

<span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="sd">"""Advance the animation by one step and update the frame."""</span>
    <span class="k">global</span> <span class="n">sim</span><span class="p">,</span> <span class="n">verts</span><span class="p">,</span> <span class="n">mb_est_line</span><span class="p">,</span> <span class="n">mb_est</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>

    <span class="n">particles</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">pos</span><span class="p">[:,</span> <span class="n">X</span><span class="p">],</span> <span class="n">sim</span><span class="o">.</span><span class="n">pos</span><span class="p">[:,</span> <span class="n">Y</span><span class="p">])</span>
    <span class="n">particles</span><span class="o">.</span><span class="n">set_markersize</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">speeds</span> <span class="o">=</span> <span class="n">get_speeds</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">vel</span><span class="p">)</span>
    <span class="n">speed_hist</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">speeds</span><span class="p">)</span>

    <span class="c1"># Once the simulation has approached equilibrium a bit, start averaging</span>
    <span class="c1"># the speed distribution to indicate the approximation to the Maxwell-</span>
    <span class="c1"># Boltzmann distribution.</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">IAV_START</span><span class="p">:</span>
        <span class="n">mb_est</span> <span class="o">+=</span> <span class="p">(</span><span class="n">speed_hist</span><span class="o">.</span><span class="n">hist</span> <span class="o">-</span> <span class="n">mb_est</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">IAV_START</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">mb_est_line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">sgrid</span><span class="p">,</span> <span class="n">mb_est</span><span class="p">)</span>

    <span class="n">label</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">'$t$ = {:.1f} ns, step = {:d}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">particles</span><span class="p">,</span> <span class="n">speed_hist</span><span class="o">.</span><span class="n">patch</span><span class="p">,</span> <span class="n">mb_est_line</span><span class="p">,</span> <span class="n">label</span>

<span class="c1"># Only start averaging the speed distribution after frame number IAV_ST.</span>
<span class="n">IAV_START</span> <span class="o">=</span> <span class="mi">200</span>
<span class="c1"># Number of frames; set to None to run until explicitly quit.</span>
<span class="n">frames</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">anim</span> <span class="o">=</span> <span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">frames</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">init_func</span><span class="o">=</span><span class="n">init_anim</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>









<div class="panel panel-default rating">
    <div class="panel-body">
    

<span id="rating-150">
    
    Current rating: 5
    
</span>


<form class="form-inline" role="form" method="post" action="/rating/">
    
    <input type='hidden' name='csrfmiddlewaretoken' value='rmxt3GvLdQIE1ze4gqwkEczGVjuca5ZXqjHKFcmgHIdVNmDuIF9cXerTELdIdBtW' />
    
    <ul class="radio radio-inline"><li> <ul id="id_value"><li><label for="id_value_0"><input id="id_value_0" name="value" type="radio" value="1" required /> 1</label></li>
<li><label for="id_value_1"><input id="id_value_1" name="value" type="radio" value="2" required /> 2</label></li>
<li><label for="id_value_2"><input id="id_value_2" name="value" type="radio" value="3" required /> 3</label></li>
<li><label for="id_value_3"><input id="id_value_3" name="value" type="radio" value="4" required /> 4</label></li>
<li><label for="id_value_4"><input id="id_value_4" name="value" type="radio" value="5" required /> 5</label></li></ul><input id="id_content_type" name="content_type" type="hidden" value="blog.blogpost" /><input id="id_object_pk" name="object_pk" type="hidden" value="150" /><input id="id_timestamp" name="timestamp" type="hidden" value="1595058375" /><input id="id_security_hash" maxlength="40" minlength="40" name="security_hash" type="hidden" value="705dcbaacbba06170a81925239614792a49c7551" /></li></ul>
    <input type="submit" class="btn btn-default btn-sm" value="Rate"
        onclick="return $(this.form).find('input:checked').length == 1;">
</form>


    </div>
</div>




<a class="btn btn-sm share-twitter" target="_blank" href="http://twitter.com/home?status=https%3A//scipython.com/blog/the-maxwellboltzmann-distribution-in-two-dimensions/%20The%20Maxwell%E2%80%93Boltzmann%20distribution%20in%20two%20dimensions">Share on Twitter</a>
<a class="btn btn-sm share-facebook" target="_blank" href="http://facebook.com/sharer.php?u=https://scipython.com/blog/the-maxwellboltzmann-distribution-in-two-dimensions/&amp;t=The%20Maxwell%E2%80%93Boltzmann%20distribution%20in%20two%20dimensions">Share on Facebook</a>



<ul class="pager">


<li class="previous">
    <a href="/blog/visualizing-the-real-forms-of-the-spherical-harmonics/">&larr; Visualizing the real forms of the spherical harmonics</a>
</li>





</ul>








<div id="comments">
<h3>Comments</h3>
<p>Comments are pre-moderated. Please be patient and your comment will appear soon.</p>

<script>
$(function() {
    $('.reply').click(function() {
        $('.comment-reply-form').hide();
        $(this).siblings('.comment-reply-form').toggle();
    });
});
</script>
<style>.input_id_honeypot {display:none !important;}</style>





<p>There are currently no comments</p>



<h3>New Comment</h3>
<form method="post" id="comment" action="/comment/#comment">
    
    



<input type="hidden" name="referrer" value="https://scipython.com/">
<input type='hidden' name='csrfmiddlewaretoken' value='rmxt3GvLdQIE1ze4gqwkEczGVjuca5ZXqjHKFcmgHIdVNmDuIF9cXerTELdIdBtW' />




<input id="id_content_type" name="content_type" type="hidden" value="blog.blogpost" />



<input id="id_object_pk" name="object_pk" type="hidden" value="150" />



<input id="id_timestamp" name="timestamp" type="hidden" value="1595058375" />



<input id="id_security_hash" maxlength="40" minlength="40" name="security_hash" type="hidden" value="705dcbaacbba06170a81925239614792a49c7551" />



<div class="form-group input_id_name 
    ">
    <label class="control-label" for="id_name">Name</label>
    <input id="id_name" maxlength="50" name="name" type="text" required />
    
    <p class="help-block">required</p>
    
</div>



<div class="form-group input_id_email 
    ">
    <label class="control-label" for="id_email">Email</label>
    <input id="id_email" name="email" type="email" required />
    
    <p class="help-block">required (not published)</p>
    
</div>



<div class="form-group input_id_url 
    ">
    <label class="control-label" for="id_url">Website</label>
    <input id="id_url" name="url" type="url" />
    
    <p class="help-block">optional</p>
    
</div>



<div class="form-group input_id_comment 
    ">
    <label class="control-label" for="id_comment">Comment</label>
    <textarea cols="40" id="id_comment" maxlength="3000" name="comment" rows="10" required>
</textarea>
    
    <p class="help-block">required</p>
    
</div>



<div class="form-group input_id_honeypot 
    ">
    <label class="control-label" for="id_honeypot">If you enter anything in this field your comment will be treated as spam</label>
    <input id="id_honeypot" name="honeypot" type="text" />
    
</div>



    
    <div class="form-actions">
        <input class="btn btn-primary btn-lg" type="submit" value="Comment">
    </div>
</form>

</div>




</div>

</div>
</div>

<footer>
<div class="container">
</div>
</footer>








<script>

var _gaq = _gaq || [['_trackPageview']];
_gaq.unshift(['_setAccount', 'UA-91424547-3']);
(function(d, t) {
    var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    g.async = true;
    g.src = '//www.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g, s);
})(document, 'script');

</script>


</body>
</html>
