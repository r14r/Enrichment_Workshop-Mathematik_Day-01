<!doctype html>
<html lang="en">


<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="keywords" content="">
<meta name="description" content="The following code implements a Quadtree in Python (see the previous blog post). There are three classes: Point represents a point in two-dimensional space, with an optional &quot;payload&quot; (data structure associating the Point with more information, for example the identity of an object). The Rect class represents a rectangle in two-dimensional space through its centre, width and height. There are methods to determine if a given Point object is inside the Rect and to determine if the Rect intersects another Rect.">
<title>Quadtrees #2: Implementation in Python</title>
<link rel="shortcut icon" href="/static/img/favicon.ico">


<link rel="alternate" type="application/rss+xml" title="RSS" href="/blog/feeds/rss/">
<link rel="alternate" type="application/atom+xml" title="Atom" href="/blog/feeds/atom/">



<link rel="stylesheet" href="/static/css/bootstrap.css">
<link rel="stylesheet" href="/static/css/mezzanine.css">
<link rel="stylesheet" href="/static/css/codehilite.css">
<link rel="stylesheet" href="/static/css/custom.css">






<script src="/static/mezzanine/js/jquery-1.8.3.min.js"></script>
<script src="/static/js/bootstrap.js"></script>
<script src="/static/js/bootstrap-extras.js"></script>



<!--[if lt IE 9]>
<script src="/static/js/html5shiv.js"></script>
<script src="/static/js/respond.min.js"></script>
<![endif]-->



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


</head>

<body id="body">

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
<div class="container">
<div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle Navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
    
    
</div>
<div class="navbar-collapse collapse">
    
<form action="/search/" class="navbar-form navbar-right" role="search">

<div class="form-group">
    <input class="form-control" placeholder="Search" type="text" name="q" value="">
</div>


    
    <div class="form-group">
    <select class="form-control" name="type">
        <option value="">Everything</option>
        
        <option value="blog.BlogPost"
            >
            Blog posts
        </option>
        
        <option value="pages.Page"
            >
            Pages
        </option>
        
    </select>
    </div>
    


<input type="submit" class="btn btn-default" value="Go">

</form>

    
<ul class="nav navbar-nav"><li id="dropdown-menu-home"><a href="/">Home</a></li><li class="dropdown
               "
        id="about"><a href="/about/"
        
        class="dropdown-toggle disabled" data-toggle="dropdown"
        >
            About
            <b class="caret"></b></a><ul class="dropdown-menu"><li class="
               "
        id="about-the-author"><a href="/about/the-author/">The Author</a></li><li class="
               "
        id="about-the-book"><a href="/about/the-book/">The Book</a></li><li class="
               "
        id="about-this-website"><a href="/about/this-website/">This Website</a></li></ul></li><li class="dropdown
               "
        id="book"><a href="/book/"
        
        class="dropdown-toggle disabled" data-toggle="dropdown"
        >
            Book
            <b class="caret"></b></a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-1-introduction"><a href="/book/chapter-1-introduction/">Chapter 1: Introduction</a></li><li class="dropdown-submenu
               "
        id="book-chapter-2-the-core-python-language-i"><a href="/book/chapter-2-the-core-python-language-i/">Chapter 2: The Core Python Language I</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-2-the-core-python-language-i-examples"><a href="/book/chapter-2-the-core-python-language-i/examples/">Examples</a></li><li class="
               "
        id="book-chapter-2-the-core-python-language-i-questions"><a href="/book/chapter-2-the-core-python-language-i/questions/">Questions</a></li><li class="
               "
        id="book-chapter-2-the-core-python-language-i-questions-problems"><a href="/book/chapter-2-the-core-python-language-i/questions/problems/">Problems</a></li><li class="
               "
        id="book-chapter-2-the-core-python-language-i-additional-problems"><a href="/book/chapter-2-the-core-python-language-i/additional-problems/">Additional Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-3-simple-plotting-with-pylab"><a href="/book/chapter-3-simple-plotting-with-pylab/">Chapter 3: Simple Plotting with pylab</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-3-simple-plotting-with-pylab-examples"><a href="/book/chapter-3-simple-plotting-with-pylab/examples/">Examples</a></li><li class="
               "
        id="book-chapter-3-simple-plotting-with-pylab-problems"><a href="/book/chapter-3-simple-plotting-with-pylab/problems/">Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-4-the-core-python-language-ii"><a href="/book/chapter-4-the-core-python-language-ii/">Chapter 4: The core Python language II</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-4-the-core-python-language-ii-examples"><a href="/book/chapter-4-the-core-python-language-ii/examples/">Examples</a></li><li class="
               "
        id="book-chapter-4-the-core-python-language-ii-questions"><a href="/book/chapter-4-the-core-python-language-ii/questions/">Questions</a></li><li class="
               "
        id="book-chapter-4-the-core-python-language-ii-problems"><a href="/book/chapter-4-the-core-python-language-ii/problems/">Problems</a></li><li class="
               "
        id="book-chapter-4-the-core-python-language-ii-additional-problems"><a href="/book/chapter-4-the-core-python-language-ii/additional-problems/">Additional Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-5-ipython-and-ipython-notebook"><a href="/book/chapter-5-ipython-and-ipython-notebook/">Chapter 5: IPython and IPython Notebook</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-5-ipython-and-ipython-notebook-examples"><a href="/book/chapter-5-ipython-and-ipython-notebook/examples/">Examples</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-6-numpy"><a href="/book/chapter-6-numpy/">Chapter 6: NumPy</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-6-numpy-examples"><a href="/book/chapter-6-numpy/examples/">Examples</a></li><li class="
               "
        id="book-chapter-6-numpy-questions"><a href="/book/chapter-6-numpy/questions/">Questions</a></li><li class="
               "
        id="book-chapter-6-numpy-problems"><a href="/book/chapter-6-numpy/problems/">Problems</a></li><li class="
               "
        id="book-chapter-6-numpy-additional-examples"><a href="/book/chapter-6-numpy/additional-examples/">Additional Examples</a></li><li class="
               "
        id="book-chapter-6-numpy-additional-problems"><a href="/book/chapter-6-numpy/additional-problems/">Additional Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-7-matplotlib"><a href="/book/chapter-7-matplotlib/">Chapter 7: Matplotlib</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-7-matplotlib-examples"><a href="/book/chapter-7-matplotlib/examples/">Examples</a></li><li class="
               "
        id="book-chapter-7-matplotlib-questions"><a href="/book/chapter-7-matplotlib/questions/">Questions</a></li><li class="
               "
        id="book-chapter-7-matplotlib-problems"><a href="/book/chapter-7-matplotlib/problems/">Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-8-scipy"><a href="/book/chapter-8-scipy/">Chapter 8: SciPy</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-8-scipy-examples"><a href="/book/chapter-8-scipy/examples/">Examples</a></li><li class="
               "
        id="book-chapter-8-scipy-questions"><a href="/book/chapter-8-scipy/questions/">Questions</a></li><li class="
               "
        id="book-chapter-8-scipy-problems"><a href="/book/chapter-8-scipy/problems/">Problems</a></li><li class="
               "
        id="book-chapter-8-scipy-additional-examples"><a href="/book/chapter-8-scipy/additional-examples/">Additional Examples</a></li><li class="
               "
        id="book-chapter-8-scipy-additional-problems"><a href="/book/chapter-8-scipy/additional-problems/">Additional Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-9-general-scientific-programming"><a href="/book/chapter-9-general-scientific-programming/">Chapter 9: General Scientific Programming</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-9-general-scientific-programming-examples"><a href="/book/chapter-9-general-scientific-programming/examples/">Examples</a></li><li class="
               "
        id="book-chapter-9-general-scientific-programming-questions"><a href="/book/chapter-9-general-scientific-programming/questions/">Questions</a></li><li class="
               "
        id="book-chapter-9-general-scientific-programming-problems"><a href="/book/chapter-9-general-scientific-programming/problems/">Problems</a></li></ul></li><li class="
               "
        id="book-errata"><a href="/book/errata/">Errata</a></li></ul></li><li class="
               active"
        id="blog"><a href="/blog/"
        >
            Blog
            
        </a></li><li class="
               "
        id="apps"><a href="/apps/"
        >
            Apps
            
        </a></li><li class="
               "
        id="contact"><a href="/contact/"
        >
            Contact
            
        </a></li></ul>

</div>
</div>
</div>

<div class="container">





<ul class="breadcrumb">
<li id="breadcrumb-menu-home"><a href="/">Home</a></li><li id="breadcrumb-menu-blog"><a href="/blog/">Blog</a></li><li class="active">Quadtrees #2: Implementation in Python</li>
</ul>

<h1>
Quadtrees #2: Implementation in Python
</h1>

</div>

<div class="container">
<div class="row">

<div class="col-md-12 middle" style="max-width: 760px;">
    



<h6 class="post-meta">
    Posted by:
    
    <a href="/blog/author/christian/">christian</a> on
    
    19 Apr 2020
</h6>



<p>
    
        (<a href="#comments">0 comments</a>)
        
    
</p>






<p>The following code implements a Quadtree in Python (see the <a href="for a description of quadtrees">previous blog post</a>). There are three classes: <code>Point</code> represents a point in two-dimensional space, with an optional "payload" (data structure associating the <code>Point</code> with more information, for example the identity of an object). The <code>Rect</code> class represents a rectangle in two-dimensional space through its centre, width and height. There are methods to determine if a given <code>Point</code> object is inside the <code>Rect</code> and to determine if the <code>Rect</code> intersects another <code>Rect</code>.</p>
<p>Finally, the <code>QuadTree</code> class represents the quadtree data structure itself. It is defined recursively, such that when a node needs to divide, it spawns four child <code>Quadtree</code>s within its domain (idenfied as northwest, northeast, southwest, southeast).</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="sd">"""A point located at (x,y) in 2D space.</span>

<span class="sd">    Each Point object may be associated with a payload object.</span>

<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'{}: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)),</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">payload</span><span class="p">))</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'P({:.2f}, {:.2f})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">distance_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">other_x</span><span class="p">,</span> <span class="n">other_y</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">other_x</span><span class="p">,</span> <span class="n">other_y</span> <span class="o">=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">other_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">other_y</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Rect</span><span class="p">:</span>
    <span class="sd">"""A rectangle centred at (cx, cy) with width w and height h."""</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cy</span> <span class="o">=</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">west_edge</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">east_edge</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">-</span> <span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">cx</span> <span class="o">+</span> <span class="n">w</span><span class="o">/</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">north_edge</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">south_edge</span> <span class="o">=</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">h</span><span class="o">/</span><span class="mi">2</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">west_edge</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">east_edge</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">north_edge</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">south_edge</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'({:.2f}, {:.2f}, {:.2f}, {:.2f})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">west_edge</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">north_edge</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">east_edge</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">south_edge</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="sd">"""Is point (a Point object or (x,y) tuple) inside this Rect?"""</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">point_x</span><span class="p">,</span> <span class="n">point_y</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">point_x</span><span class="p">,</span> <span class="n">point_y</span> <span class="o">=</span> <span class="n">point</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">point_x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">west_edge</span> <span class="ow">and</span>
                <span class="n">point_x</span> <span class="o">&lt;</span>  <span class="bp">self</span><span class="o">.</span><span class="n">east_edge</span> <span class="ow">and</span>
                <span class="n">point_y</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">north_edge</span> <span class="ow">and</span>
                <span class="n">point_y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">south_edge</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">"""Does Rect object other interesect this Rect?"""</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">west_edge</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">east_edge</span> <span class="ow">or</span>
                    <span class="n">other</span><span class="o">.</span><span class="n">east_edge</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">west_edge</span> <span class="ow">or</span>
                    <span class="n">other</span><span class="o">.</span><span class="n">north_edge</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">south_edge</span> <span class="ow">or</span>
                    <span class="n">other</span><span class="o">.</span><span class="n">south_edge</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">north_edge</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">west_edge</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">north_edge</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">east_edge</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">south_edge</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x1</span><span class="p">],[</span><span class="n">y1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">y1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">QuadTree</span><span class="p">:</span>
    <span class="sd">"""A class implementing a quadtree."""</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">max_points</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">"""Initialize this node of the quadtree.</span>

<span class="sd">        boundary is a Rect object defining the region from which points are</span>
<span class="sd">        placed into this node; max_points is the maximum number of points the</span>
<span class="sd">        node can hold before it must divide (branch into four more nodes);</span>
<span class="sd">        depth keeps track of how deep into the quadtree this node lies.</span>

<span class="sd">        """</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span> <span class="o">=</span> <span class="n">boundary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_points</span> <span class="o">=</span> <span class="n">max_points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>
        <span class="c1"># A flag to indicate whether this node has divided (branched) or not.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">divided</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Return a string representation of this node, suitably formatted."""</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="s1">' '</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">sp</span> <span class="o">+</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">divided</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="n">sp</span> <span class="o">+</span> <span class="s1">'nw: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nw</span><span class="p">),</span> <span class="n">sp</span> <span class="o">+</span> <span class="s1">'ne: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ne</span><span class="p">),</span>
                <span class="n">sp</span> <span class="o">+</span> <span class="s1">'se: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">se</span><span class="p">),</span> <span class="n">sp</span> <span class="o">+</span> <span class="s1">'sw: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sw</span><span class="p">)])</span>

    <span class="k">def</span> <span class="nf">divide</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Divide (branch) this node by spawning four children nodes."""</span>

        <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">cy</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">h</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="c1"># The boundaries of the four children nodes are "northwest",</span>
        <span class="c1"># "northeast", "southeast" and "southwest" quadrants within the</span>
        <span class="c1"># boundary of the current node.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nw</span> <span class="o">=</span> <span class="n">QuadTree</span><span class="p">(</span><span class="n">Rect</span><span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">max_points</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ne</span> <span class="o">=</span> <span class="n">QuadTree</span><span class="p">(</span><span class="n">Rect</span><span class="p">(</span><span class="n">cx</span> <span class="o">+</span> <span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">max_points</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">se</span> <span class="o">=</span> <span class="n">QuadTree</span><span class="p">(</span><span class="n">Rect</span><span class="p">(</span><span class="n">cx</span> <span class="o">+</span> <span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">max_points</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sw</span> <span class="o">=</span> <span class="n">QuadTree</span><span class="p">(</span><span class="n">Rect</span><span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">max_points</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">divided</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="sd">"""Try to insert Point point into this QuadTree."""</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>
            <span class="c1"># The point does not lie inside boundary: bail.</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_points</span><span class="p">:</span>
            <span class="c1"># There's room for our point without dividing the QuadTree.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="c1"># No room: divide if necessary, then try the sub-quads.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">divided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">divide</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ne</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nw</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">se</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sw</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">point</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">found_points</span><span class="p">):</span>
        <span class="sd">"""Find the points in the quadtree that lie within boundary."""</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">boundary</span><span class="p">):</span>
            <span class="c1"># If the domain of this node does not intersect the search</span>
            <span class="c1"># region, we don't need to look in it for points.</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="c1"># Search this node's points to see if they lie within boundary ...</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">boundary</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>
                <span class="n">found_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
        <span class="c1"># ... and if this node has children, search them too.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">divided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nw</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">boundary</span><span class="p">,</span> <span class="n">found_points</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ne</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">boundary</span><span class="p">,</span> <span class="n">found_points</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">se</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">boundary</span><span class="p">,</span> <span class="n">found_points</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sw</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">boundary</span><span class="p">,</span> <span class="n">found_points</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">found_points</span>


    <span class="k">def</span> <span class="nf">query_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">centre</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">found_points</span><span class="p">):</span>
        <span class="sd">"""Find the points in the quadtree that lie within radius of centre.</span>

<span class="sd">        boundary is a Rect object (a square) that bounds the search circle.</span>
<span class="sd">        There is no need to call this method directly: use query_radius.</span>

<span class="sd">        """</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">boundary</span><span class="p">):</span>
            <span class="c1"># If the domain of this node does not intersect the search</span>
            <span class="c1"># region, we don't need to look in it for points.</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="c1"># Search this node's points to see if they lie within boundary</span>
        <span class="c1"># and also lie within a circle of given radius around the centre point.</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">boundary</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="n">point</span><span class="o">.</span><span class="n">distance_to</span><span class="p">(</span><span class="n">centre</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">):</span>
                <span class="n">found_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

        <span class="c1"># Recurse the search into this node's children.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">divided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nw</span><span class="o">.</span><span class="n">query_circle</span><span class="p">(</span><span class="n">boundary</span><span class="p">,</span> <span class="n">centre</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">found_points</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ne</span><span class="o">.</span><span class="n">query_circle</span><span class="p">(</span><span class="n">boundary</span><span class="p">,</span> <span class="n">centre</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">found_points</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">se</span><span class="o">.</span><span class="n">query_circle</span><span class="p">(</span><span class="n">boundary</span><span class="p">,</span> <span class="n">centre</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">found_points</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sw</span><span class="o">.</span><span class="n">query_circle</span><span class="p">(</span><span class="n">boundary</span><span class="p">,</span> <span class="n">centre</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">found_points</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">found_points</span>

    <span class="k">def</span> <span class="nf">query_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">centre</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">found_points</span><span class="p">):</span>
        <span class="sd">"""Find the points in the quadtree that lie within radius of centre."""</span>

        <span class="c1"># First find the square that bounds the search circle as a Rect object.</span>
        <span class="n">boundary</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="o">*</span><span class="n">centre</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">radius</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">radius</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_circle</span><span class="p">(</span><span class="n">boundary</span><span class="p">,</span> <span class="n">centre</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">found_points</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Return the number of points in the quadtree."""</span>

        <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">divided</span><span class="p">:</span>
            <span class="n">npoints</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nw</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ne</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">se</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">npoints</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">"""Draw a representation of the quadtree on Matplotlib Axes ax."""</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">divided</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nw</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ne</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">se</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sw</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
</pre></div>


<p>In the following test, the domain is populated with points from a two-dimensional normal distribution. These are stored in a quadtree which is then queried for points that fall within a rectangle defined by <code>Rect(140, 190, 150, 150)</code>. This query is efficient in that it onlyt examines nodes whose boundaries intersect with the search area, ignoring those containg only points which lie outside it. The found points are highlighted in red in the figure below.</p>
<p><img alt="Quadtree search" class="fig" src="/static/media/uploads/blog/quadtree/search-quadtree.png"></p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">quadtree</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Rect</span><span class="p">,</span> <span class="n">QuadTree</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>

<span class="n">DPI</span> <span class="o">=</span> <span class="mi">72</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

<span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">400</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">height</span><span class="o">/</span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">coord</span><span class="p">)</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">]</span>

<span class="n">domain</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
<span class="n">qtree</span> <span class="o">=</span> <span class="n">QuadTree</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
    <span class="n">qtree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">'Number of points in the domain ='</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">qtree</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">700</span><span class="o">/</span><span class="n">DPI</span><span class="p">,</span> <span class="mi">500</span><span class="o">/</span><span class="n">DPI</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
<span class="n">qtree</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">],</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

<span class="n">region</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
<span class="n">found_points</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">qtree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">found_points</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'Number of found points ='</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_points</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">found_points</span><span class="p">],</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">found_points</span><span class="p">],</span>
           <span class="n">facecolors</span><span class="o">=</span><span class="s1">'none'</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>

<span class="n">region</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">'r'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'search-quadtree.png'</span><span class="p">,</span> <span class="n">DPI</span><span class="o">=</span><span class="mi">72</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p>A similar test searches for points a fixed distance (<code>radius</code>) from some provided central point (<code>centre</code>) by constructing the bounding <code>Rect</code> and rejecting points inside it that do not lie within <code>radius</code> or <code>centre</code>.</p>
<p><img alt="enter image description here" class="fig" src="/static/media/uploads/blog/quadtree/search-quadtree-circle.png"></p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">quadtree</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Rect</span><span class="p">,</span> <span class="n">QuadTree</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>

<span class="n">DPI</span> <span class="o">=</span> <span class="mi">72</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

<span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">400</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">1500</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">height</span><span class="o">/</span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">coord</span><span class="p">)</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">]</span>

<span class="n">domain</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
<span class="n">qtree</span> <span class="o">=</span> <span class="n">QuadTree</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
    <span class="n">qtree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">'Number of points in the domain ='</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">qtree</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">700</span><span class="o">/</span><span class="n">DPI</span><span class="p">,</span> <span class="mi">500</span><span class="o">/</span><span class="n">DPI</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
<span class="n">qtree</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">],</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

<span class="n">centre</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="mi">120</span>
<span class="n">found_points</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">qtree</span><span class="o">.</span><span class="n">query_radius</span><span class="p">(</span><span class="n">centre</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">found_points</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'Number of found points ='</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_points</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">found_points</span><span class="p">],</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">found_points</span><span class="p">],</span>
           <span class="n">facecolors</span><span class="o">=</span><span class="s1">'none'</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>

<span class="n">circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">centre</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">'r'</span><span class="p">)</span>
<span class="n">Rect</span><span class="p">(</span><span class="o">*</span><span class="n">centre</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">radius</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">radius</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">'r'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'search-quadtree-circle.png'</span><span class="p">,</span> <span class="n">DPI</span><span class="o">=</span><span class="mi">72</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>









<div class="panel panel-default rating">
    <div class="panel-body">
    

<span id="rating-144">
    
    Current rating: 4.5
    
</span>


<form class="form-inline" role="form" method="post" action="/rating/">
    
    <input type='hidden' name='csrfmiddlewaretoken' value='rbUJEuwlytYH40loGIPnBtnBvZhaVsGJq840g0nQ2ltYQNKO8XsfUvfOer0GYYaI' />
    
    <ul class="radio radio-inline"><li> <ul id="id_value"><li><label for="id_value_0"><input id="id_value_0" name="value" type="radio" value="1" required /> 1</label></li>
<li><label for="id_value_1"><input id="id_value_1" name="value" type="radio" value="2" required /> 2</label></li>
<li><label for="id_value_2"><input id="id_value_2" name="value" type="radio" value="3" required /> 3</label></li>
<li><label for="id_value_3"><input id="id_value_3" name="value" type="radio" value="4" required /> 4</label></li>
<li><label for="id_value_4"><input id="id_value_4" name="value" type="radio" value="5" required /> 5</label></li></ul><input id="id_content_type" name="content_type" type="hidden" value="blog.blogpost" /><input id="id_object_pk" name="object_pk" type="hidden" value="144" /><input id="id_timestamp" name="timestamp" type="hidden" value="1595058378" /><input id="id_security_hash" maxlength="40" minlength="40" name="security_hash" type="hidden" value="1b470e8e379a6108f4760485150516c6afc0f101" /></li></ul>
    <input type="submit" class="btn btn-default btn-sm" value="Rate"
        onclick="return $(this.form).find('input:checked').length == 1;">
</form>


    </div>
</div>




<a class="btn btn-sm share-twitter" target="_blank" href="http://twitter.com/home?status=https%3A//scipython.com/blog/quadtrees-2-implementation-in-python/%20Quadtrees%20%232%3A%20Implementation%20in%20Python">Share on Twitter</a>
<a class="btn btn-sm share-facebook" target="_blank" href="http://facebook.com/sharer.php?u=https://scipython.com/blog/quadtrees-2-implementation-in-python/&amp;t=Quadtrees%20%232%3A%20Implementation%20in%20Python">Share on Facebook</a>



<ul class="pager">


<li class="previous">
    <a href="/blog/the-double-compound-pendulum/">&larr; The double compound pendulum</a>
</li>




<li class="next">
    <a href="/blog/inflation-in-austria/">Inflation in Austria &rarr;</a>
</li>


</ul>




<div id="related-posts">
<h3>Related posts</h3>
<ul class="list-unstyled">

     <li><a href="/blog/quadtree-1-background/">Quadtrees #1: Background</a></li>

</ul>
</div>





<div id="comments">
<h3>Comments</h3>
<p>Comments are pre-moderated. Please be patient and your comment will appear soon.</p>

<script>
$(function() {
    $('.reply').click(function() {
        $('.comment-reply-form').hide();
        $(this).siblings('.comment-reply-form').toggle();
    });
});
</script>
<style>.input_id_honeypot {display:none !important;}</style>





<p>There are currently no comments</p>



<h3>New Comment</h3>
<form method="post" id="comment" action="/comment/#comment">
    
    



<input type="hidden" name="referrer" value="https://scipython.com/">
<input type='hidden' name='csrfmiddlewaretoken' value='rbUJEuwlytYH40loGIPnBtnBvZhaVsGJq840g0nQ2ltYQNKO8XsfUvfOer0GYYaI' />




<input id="id_content_type" name="content_type" type="hidden" value="blog.blogpost" />



<input id="id_object_pk" name="object_pk" type="hidden" value="144" />



<input id="id_timestamp" name="timestamp" type="hidden" value="1595058379" />



<input id="id_security_hash" maxlength="40" minlength="40" name="security_hash" type="hidden" value="262bbf7c50c99c2088afb34d5310811749476fb9" />



<div class="form-group input_id_name 
    ">
    <label class="control-label" for="id_name">Name</label>
    <input id="id_name" maxlength="50" name="name" type="text" required />
    
    <p class="help-block">required</p>
    
</div>



<div class="form-group input_id_email 
    ">
    <label class="control-label" for="id_email">Email</label>
    <input id="id_email" name="email" type="email" required />
    
    <p class="help-block">required (not published)</p>
    
</div>



<div class="form-group input_id_url 
    ">
    <label class="control-label" for="id_url">Website</label>
    <input id="id_url" name="url" type="url" />
    
    <p class="help-block">optional</p>
    
</div>



<div class="form-group input_id_comment 
    ">
    <label class="control-label" for="id_comment">Comment</label>
    <textarea cols="40" id="id_comment" maxlength="3000" name="comment" rows="10" required>
</textarea>
    
    <p class="help-block">required</p>
    
</div>



<div class="form-group input_id_honeypot 
    ">
    <label class="control-label" for="id_honeypot">If you enter anything in this field your comment will be treated as spam</label>
    <input id="id_honeypot" name="honeypot" type="text" />
    
</div>



    
    <div class="form-actions">
        <input class="btn btn-primary btn-lg" type="submit" value="Comment">
    </div>
</form>

</div>




</div>

</div>
</div>

<footer>
<div class="container">
</div>
</footer>








<script>

var _gaq = _gaq || [['_trackPageview']];
_gaq.unshift(['_setAccount', 'UA-91424547-3']);
(function(d, t) {
    var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    g.async = true;
    g.src = '//www.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g, s);
})(document, 'script');

</script>


</body>
</html>
