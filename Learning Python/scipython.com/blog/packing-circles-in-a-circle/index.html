<!doctype html>
<html lang="en">


<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="keywords" content="">
<meta name="description" content="The following code attempts to pack a predefined number of smaller circles (of random radii between two given limits) into a larger one.">
<title>Packing circles in a circle</title>
<link rel="shortcut icon" href="/static/img/favicon.ico">


<link rel="alternate" type="application/rss+xml" title="RSS" href="/blog/feeds/rss/">
<link rel="alternate" type="application/atom+xml" title="Atom" href="/blog/feeds/atom/">



<link rel="stylesheet" href="/static/css/bootstrap.css">
<link rel="stylesheet" href="/static/css/mezzanine.css">
<link rel="stylesheet" href="/static/css/codehilite.css">
<link rel="stylesheet" href="/static/css/custom.css">






<script src="/static/mezzanine/js/jquery-1.8.3.min.js"></script>
<script src="/static/js/bootstrap.js"></script>
<script src="/static/js/bootstrap-extras.js"></script>



<!--[if lt IE 9]>
<script src="/static/js/html5shiv.js"></script>
<script src="/static/js/respond.min.js"></script>
<![endif]-->



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


</head>

<body id="body">

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
<div class="container">
<div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle Navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
    
    
</div>
<div class="navbar-collapse collapse">
    
<form action="/search/" class="navbar-form navbar-right" role="search">

<div class="form-group">
    <input class="form-control" placeholder="Search" type="text" name="q" value="">
</div>


    
    <div class="form-group">
    <select class="form-control" name="type">
        <option value="">Everything</option>
        
        <option value="blog.BlogPost"
            >
            Blog posts
        </option>
        
        <option value="pages.Page"
            >
            Pages
        </option>
        
    </select>
    </div>
    


<input type="submit" class="btn btn-default" value="Go">

</form>

    
<ul class="nav navbar-nav"><li id="dropdown-menu-home"><a href="/">Home</a></li><li class="dropdown
               "
        id="about"><a href="/about/"
        
        class="dropdown-toggle disabled" data-toggle="dropdown"
        >
            About
            <b class="caret"></b></a><ul class="dropdown-menu"><li class="
               "
        id="about-the-author"><a href="/about/the-author/">The Author</a></li><li class="
               "
        id="about-the-book"><a href="/about/the-book/">The Book</a></li><li class="
               "
        id="about-this-website"><a href="/about/this-website/">This Website</a></li></ul></li><li class="dropdown
               "
        id="book"><a href="/book/"
        
        class="dropdown-toggle disabled" data-toggle="dropdown"
        >
            Book
            <b class="caret"></b></a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-1-introduction"><a href="/book/chapter-1-introduction/">Chapter 1: Introduction</a></li><li class="dropdown-submenu
               "
        id="book-chapter-2-the-core-python-language-i"><a href="/book/chapter-2-the-core-python-language-i/">Chapter 2: The Core Python Language I</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-2-the-core-python-language-i-examples"><a href="/book/chapter-2-the-core-python-language-i/examples/">Examples</a></li><li class="
               "
        id="book-chapter-2-the-core-python-language-i-questions"><a href="/book/chapter-2-the-core-python-language-i/questions/">Questions</a></li><li class="
               "
        id="book-chapter-2-the-core-python-language-i-questions-problems"><a href="/book/chapter-2-the-core-python-language-i/questions/problems/">Problems</a></li><li class="
               "
        id="book-chapter-2-the-core-python-language-i-additional-problems"><a href="/book/chapter-2-the-core-python-language-i/additional-problems/">Additional Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-3-simple-plotting-with-pylab"><a href="/book/chapter-3-simple-plotting-with-pylab/">Chapter 3: Simple Plotting with pylab</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-3-simple-plotting-with-pylab-examples"><a href="/book/chapter-3-simple-plotting-with-pylab/examples/">Examples</a></li><li class="
               "
        id="book-chapter-3-simple-plotting-with-pylab-problems"><a href="/book/chapter-3-simple-plotting-with-pylab/problems/">Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-4-the-core-python-language-ii"><a href="/book/chapter-4-the-core-python-language-ii/">Chapter 4: The core Python language II</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-4-the-core-python-language-ii-examples"><a href="/book/chapter-4-the-core-python-language-ii/examples/">Examples</a></li><li class="
               "
        id="book-chapter-4-the-core-python-language-ii-questions"><a href="/book/chapter-4-the-core-python-language-ii/questions/">Questions</a></li><li class="
               "
        id="book-chapter-4-the-core-python-language-ii-problems"><a href="/book/chapter-4-the-core-python-language-ii/problems/">Problems</a></li><li class="
               "
        id="book-chapter-4-the-core-python-language-ii-additional-problems"><a href="/book/chapter-4-the-core-python-language-ii/additional-problems/">Additional Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-5-ipython-and-ipython-notebook"><a href="/book/chapter-5-ipython-and-ipython-notebook/">Chapter 5: IPython and IPython Notebook</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-5-ipython-and-ipython-notebook-examples"><a href="/book/chapter-5-ipython-and-ipython-notebook/examples/">Examples</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-6-numpy"><a href="/book/chapter-6-numpy/">Chapter 6: NumPy</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-6-numpy-examples"><a href="/book/chapter-6-numpy/examples/">Examples</a></li><li class="
               "
        id="book-chapter-6-numpy-questions"><a href="/book/chapter-6-numpy/questions/">Questions</a></li><li class="
               "
        id="book-chapter-6-numpy-problems"><a href="/book/chapter-6-numpy/problems/">Problems</a></li><li class="
               "
        id="book-chapter-6-numpy-additional-examples"><a href="/book/chapter-6-numpy/additional-examples/">Additional Examples</a></li><li class="
               "
        id="book-chapter-6-numpy-additional-problems"><a href="/book/chapter-6-numpy/additional-problems/">Additional Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-7-matplotlib"><a href="/book/chapter-7-matplotlib/">Chapter 7: Matplotlib</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-7-matplotlib-examples"><a href="/book/chapter-7-matplotlib/examples/">Examples</a></li><li class="
               "
        id="book-chapter-7-matplotlib-questions"><a href="/book/chapter-7-matplotlib/questions/">Questions</a></li><li class="
               "
        id="book-chapter-7-matplotlib-problems"><a href="/book/chapter-7-matplotlib/problems/">Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-8-scipy"><a href="/book/chapter-8-scipy/">Chapter 8: SciPy</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-8-scipy-examples"><a href="/book/chapter-8-scipy/examples/">Examples</a></li><li class="
               "
        id="book-chapter-8-scipy-questions"><a href="/book/chapter-8-scipy/questions/">Questions</a></li><li class="
               "
        id="book-chapter-8-scipy-problems"><a href="/book/chapter-8-scipy/problems/">Problems</a></li><li class="
               "
        id="book-chapter-8-scipy-additional-examples"><a href="/book/chapter-8-scipy/additional-examples/">Additional Examples</a></li><li class="
               "
        id="book-chapter-8-scipy-additional-problems"><a href="/book/chapter-8-scipy/additional-problems/">Additional Problems</a></li></ul></li><li class="dropdown-submenu
               "
        id="book-chapter-9-general-scientific-programming"><a href="/book/chapter-9-general-scientific-programming/">Chapter 9: General Scientific Programming</a><ul class="dropdown-menu"><li class="
               "
        id="book-chapter-9-general-scientific-programming-examples"><a href="/book/chapter-9-general-scientific-programming/examples/">Examples</a></li><li class="
               "
        id="book-chapter-9-general-scientific-programming-questions"><a href="/book/chapter-9-general-scientific-programming/questions/">Questions</a></li><li class="
               "
        id="book-chapter-9-general-scientific-programming-problems"><a href="/book/chapter-9-general-scientific-programming/problems/">Problems</a></li></ul></li><li class="
               "
        id="book-errata"><a href="/book/errata/">Errata</a></li></ul></li><li class="
               active"
        id="blog"><a href="/blog/"
        >
            Blog
            
        </a></li><li class="
               "
        id="apps"><a href="/apps/"
        >
            Apps
            
        </a></li><li class="
               "
        id="contact"><a href="/contact/"
        >
            Contact
            
        </a></li></ul>

</div>
</div>
</div>

<div class="container">





<ul class="breadcrumb">
<li id="breadcrumb-menu-home"><a href="/">Home</a></li><li id="breadcrumb-menu-blog"><a href="/blog/">Blog</a></li><li class="active">Packing circles in a circle</li>
</ul>

<h1>
Packing circles in a circle
</h1>

</div>

<div class="container">
<div class="row">

<div class="col-md-12 middle" style="max-width: 760px;">
    



<h6 class="post-meta">
    Posted by:
    
    <a href="/blog/author/christian/">christian</a> on
    
    2 Jun 2019
</h6>



<p>
    
        (<a href="#comments">0 comments</a>)
        
    
</p>






<p>The following code attempts to pack a predefined number of smaller circles (of random radii between two given limits) into a larger one.</p>
<p>The algorithm simply selects a random set of radii, sorts them into decreasing order (so the larger circles get placed first), and keeps track of where each circle has been placed. In attempting to place the next circle, it selects a uniformly random point within the containing circle as its centre and checks that it will not overlap any other. If it will, another point is selected (up to some sensible limit of attempts, after which we give up trying to place the circle and move onto the next, smaller one).</p>
<p><img alt="enter image description here" class="fig" src="/static/media/uploads/blog/circles/circles.png"></p>
<p>The image dimensions, colour palette, outer circle size, inner circle size range and number of inner circles can be customized in the constructor to the <code>Circles</code> class. </p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">Circle</span><span class="p">:</span>
    <span class="sd">"""A little class representing an SVG circle."""</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">icolour</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">"""Initialize the circle with its centre, (cx,cy) and radius, r.</span>

<span class="sd">        icolour is the index of the circle's colour.</span>

<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icolour</span> <span class="o">=</span> <span class="n">icolour</span>

    <span class="k">def</span> <span class="nf">overlap_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="sd">"""Does the circle overlap with another of radius r at (cx, cy)?"""</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">cx</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">r</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span>

    <span class="k">def</span> <span class="nf">draw_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fo</span><span class="p">):</span>
        <span class="sd">"""Write the circle's SVG to the output stream, fo."""</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">'&lt;circle cx="{}" cy="{}" r="{}" class="c{}"/&gt;'</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">icolour</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fo</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Circles</span><span class="p">:</span>
    <span class="sd">"""A class for drawing circles-inside-a-circle."""</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">rho_min</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span>
                 <span class="n">rho_max</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">colours</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">"""Initialize the Circles object.</span>

<span class="sd">        width, height are the SVG canvas dimensions</span>
<span class="sd">        R is the radius of the large circle within which the small circles are</span>
<span class="sd">        to fit.</span>
<span class="sd">        n is the maximum number of circles to pack inside the large circle.</span>
<span class="sd">        rho_min is rmin/R, giving the minimum packing circle radius.</span>
<span class="sd">        rho_max is rmax/R, giving the maximum packing circle radius.</span>
<span class="sd">        colours is a list of SVG fill colour specifiers to be referenced by</span>
<span class="sd">            the class identifiers c&lt;i&gt;. If None, a default palette is set.</span>

<span class="sd">        """</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">n</span>
        <span class="c1"># The centre of the canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmax</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">rho_min</span><span class="p">,</span> <span class="n">R</span> <span class="o">*</span> <span class="n">rho_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colours</span> <span class="o">=</span> <span class="n">colours</span> <span class="ow">or</span> <span class="p">[</span><span class="s1">'#993300'</span><span class="p">,</span> <span class="s1">'#a5c916'</span><span class="p">,</span> <span class="s1">'#00AA66'</span><span class="p">,</span> <span class="s1">'#FF9900'</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">preamble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""The usual SVG preamble, including the image size."""</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">'&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><span class="se">\n</span><span class="s1">'</span>

        <span class="s1">'&lt;svg xmlns="http://www.w3.org/2000/svg"</span><span class="se">\n</span><span class="s1">'</span> <span class="o">+</span> <span class="s1">' '</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span>
          <span class="s1">'xmlns:xlink="http://www.w3.org/1999/xlink" width="{}" height="{}" &gt;'</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fo</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">defs_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="sd">"""For convenience, wrap the CSS styles with the needed SVG tags."""</span>

        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">            &lt;defs&gt;</span>
<span class="s2">            &lt;style type="text/css"&gt;&lt;![CDATA["""</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fo</span><span class="p">)</span>

            <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">print</span><span class="p">(</span><span class="s2">"""]]&gt;&lt;/style&gt;</span>
<span class="s2">            &lt;/defs&gt;"""</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fo</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="nd">@defs_decorator</span>
    <span class="k">def</span> <span class="nf">svg_styles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Set the SVG styles: circles are coloured with no border."""</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">'circle {stroke: none;}'</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fo</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colours</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">'.c{} {{fill: {};}}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fo</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_svg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""Create the image as an SVG file with name filename."""</span>

        <span class="n">ncolours</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colours</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="bp">self</span><span class="o">.</span><span class="n">fo</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preamble</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svg_styles</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">circle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">circles</span><span class="p">:</span>
                <span class="n">circle</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fo</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">'&lt;/svg&gt;'</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fo</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_place_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="c1"># The guard number: if we don't place a circle within this number</span>
        <span class="c1"># of trials, we give up.</span>
        <span class="n">guard</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="k">while</span> <span class="n">guard</span><span class="p">:</span>
            <span class="c1"># Pick a random position, uniformly on the larger circle's interior</span>
            <span class="n">cr</span><span class="p">,</span> <span class="n">cphi</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()),</span>
                         <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="p">)</span>
            <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">cr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">cphi</span><span class="p">),</span> <span class="n">cr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">cphi</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cr</span><span class="o">+</span><span class="n">r</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">:</span>
            <span class="c1"># The circle fits inside the larger circle.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">circle</span><span class="o">.</span><span class="n">overlap_with</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CX</span><span class="o">+</span><span class="n">cx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CY</span><span class="o">+</span><span class="n">cy</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
                                    <span class="k">for</span> <span class="n">circle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">circles</span><span class="p">):</span>
                    <span class="c1"># The circle doesn't overlap any other circle: place it.</span>
                    <span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">cx</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">CX</span><span class="p">,</span> <span class="n">cy</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">CY</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span>
                                <span class="n">icolour</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colours</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">circles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
                    <span class="k">return</span>
            <span class="n">guard</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="c1"># Warn that we reached the guard number of attempts and gave up for</span>
        <span class="c1"># for this circle.</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'guard reached.'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_circles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Place the little circles inside the big one."""</span>

        <span class="c1"># First choose a set of n random radii and sort them. We use</span>
        <span class="c1"># random.random() * random.random() to favour small circles.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">circles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmax</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="n">r</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="c1"># Do our best to place the circles, larger ones first.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_place_circle</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">circles</span> <span class="o">=</span> <span class="n">Circles</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">circles</span><span class="o">.</span><span class="n">make_circles</span><span class="p">()</span>
<span class="n">circles</span><span class="o">.</span><span class="n">make_svg</span><span class="p">(</span><span class="s1">'circles.svg'</span><span class="p">)</span>
</pre></div>


<p><em>This project was inspired by <a href="https://bl.ocks.org/gouldingken/8d0b7a05b0b0156da3b8">Ken Goulding's block</a> in JavaScript.</em></p>









<div class="panel panel-default rating">
    <div class="panel-body">
    

<span id="rating-119">
    
    Current rating: 5
    
</span>


<form class="form-inline" role="form" method="post" action="/rating/">
    
    <input type='hidden' name='csrfmiddlewaretoken' value='PvzK8PWut3JdXbUIXWjOiMQ1xcS9pRwZOsJ1KlNZXVeuJYj8pbWGBOIegEBFsn0Y' />
    
    <ul class="radio radio-inline"><li> <ul id="id_value"><li><label for="id_value_0"><input id="id_value_0" name="value" type="radio" value="1" required /> 1</label></li>
<li><label for="id_value_1"><input id="id_value_1" name="value" type="radio" value="2" required /> 2</label></li>
<li><label for="id_value_2"><input id="id_value_2" name="value" type="radio" value="3" required /> 3</label></li>
<li><label for="id_value_3"><input id="id_value_3" name="value" type="radio" value="4" required /> 4</label></li>
<li><label for="id_value_4"><input id="id_value_4" name="value" type="radio" value="5" required /> 5</label></li></ul><input id="id_content_type" name="content_type" type="hidden" value="blog.blogpost" /><input id="id_object_pk" name="object_pk" type="hidden" value="119" /><input id="id_timestamp" name="timestamp" type="hidden" value="1595058388" /><input id="id_security_hash" maxlength="40" minlength="40" name="security_hash" type="hidden" value="1292477121be97ea19c4a2eca3ee690e151ed450" /></li></ul>
    <input type="submit" class="btn btn-default btn-sm" value="Rate"
        onclick="return $(this.form).find('input:checked').length == 1;">
</form>


    </div>
</div>




<a class="btn btn-sm share-twitter" target="_blank" href="http://twitter.com/home?status=https%3A//scipython.com/blog/packing-circles-in-a-circle/%20Packing%20circles%20in%20a%20circle">Share on Twitter</a>
<a class="btn btn-sm share-facebook" target="_blank" href="http://facebook.com/sharer.php?u=https://scipython.com/blog/packing-circles-in-a-circle/&amp;t=Packing%20circles%20in%20a%20circle">Share on Facebook</a>



<ul class="pager">


<li class="previous">
    <a href="/blog/the-morse-oscillator/">&larr; The Morse oscillator</a>
</li>




<li class="next">
    <a href="/blog/packing-circles-inside-a-shape/">Packing circles inside a shape &rarr;</a>
</li>


</ul>




<div id="related-posts">
<h3>Related posts</h3>
<ul class="list-unstyled">

     <li><a href="/blog/packing-circles-inside-a-shape/">Packing circles inside a shape</a></li>

</ul>
</div>





<div id="comments">
<h3>Comments</h3>
<p>Comments are pre-moderated. Please be patient and your comment will appear soon.</p>

<script>
$(function() {
    $('.reply').click(function() {
        $('.comment-reply-form').hide();
        $(this).siblings('.comment-reply-form').toggle();
    });
});
</script>
<style>.input_id_honeypot {display:none !important;}</style>





<p>There are currently no comments</p>



<h3>New Comment</h3>
<form method="post" id="comment" action="/comment/#comment">
    
    



<input type="hidden" name="referrer" value="https://scipython.com/">
<input type='hidden' name='csrfmiddlewaretoken' value='PvzK8PWut3JdXbUIXWjOiMQ1xcS9pRwZOsJ1KlNZXVeuJYj8pbWGBOIegEBFsn0Y' />




<input id="id_content_type" name="content_type" type="hidden" value="blog.blogpost" />



<input id="id_object_pk" name="object_pk" type="hidden" value="119" />



<input id="id_timestamp" name="timestamp" type="hidden" value="1595058388" />



<input id="id_security_hash" maxlength="40" minlength="40" name="security_hash" type="hidden" value="1292477121be97ea19c4a2eca3ee690e151ed450" />



<div class="form-group input_id_name 
    ">
    <label class="control-label" for="id_name">Name</label>
    <input id="id_name" maxlength="50" name="name" type="text" required />
    
    <p class="help-block">required</p>
    
</div>



<div class="form-group input_id_email 
    ">
    <label class="control-label" for="id_email">Email</label>
    <input id="id_email" name="email" type="email" required />
    
    <p class="help-block">required (not published)</p>
    
</div>



<div class="form-group input_id_url 
    ">
    <label class="control-label" for="id_url">Website</label>
    <input id="id_url" name="url" type="url" />
    
    <p class="help-block">optional</p>
    
</div>



<div class="form-group input_id_comment 
    ">
    <label class="control-label" for="id_comment">Comment</label>
    <textarea cols="40" id="id_comment" maxlength="3000" name="comment" rows="10" required>
</textarea>
    
    <p class="help-block">required</p>
    
</div>



<div class="form-group input_id_honeypot 
    ">
    <label class="control-label" for="id_honeypot">If you enter anything in this field your comment will be treated as spam</label>
    <input id="id_honeypot" name="honeypot" type="text" />
    
</div>



    
    <div class="form-actions">
        <input class="btn btn-primary btn-lg" type="submit" value="Comment">
    </div>
</form>

</div>




</div>

</div>
</div>

<footer>
<div class="container">
</div>
</footer>








<script>

var _gaq = _gaq || [['_trackPageview']];
_gaq.unshift(['_setAccount', 'UA-91424547-3']);
(function(d, t) {
    var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    g.async = true;
    g.src = '//www.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g, s);
})(document, 'script');

</script>


</body>
</html>
